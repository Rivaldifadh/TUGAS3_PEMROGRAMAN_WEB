
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Stok Bahan Ajar & Tracking DO</title>

  <!-- BOOTSTRAP -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
 <link rel="stylesheet" href="style.css"
  <!-- ICON -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
</head>

<body>
<div id="app" class="container py-4">

  <h2 class="mb-3 text-center fw-bold">üìö Manajemen Stok Bahan Ajar & Tracking Delivery Order</h2>

  <!-- TAB -->
  <div class="d-flex gap-2 justify-content-center mb-4">
    <button class="btn" :class="{ 'tab-btn-active': tab==='stok' }" @click="tab='stok'">Manajemen Stok</button>
    <button class="btn" :class="{ 'tab-btn-active': tab==='do' }" @click="tab='do'">Tracking DO</button>
  </div>

  <!-- ==== STOCK TAB ==== -->
  <section v-show="tab==='stok'">

    <div class="d-flex mb-3 gap-2">
      <button class="btn btn-primary" @click="openCreateStock">Tambah Bahan Ajar</button>

      <select class="form-select w-auto" v-model="filters.upbjj">
        <option value="">Semua UPBJJ</option>
        <option v-for="u in upbjjList" :key="u">{{u}}</option>
      </select>

      <select class="form-select w-auto" v-model="filters.kategori">
        <option value="">Semua Kategori</option>
        <option v-for="k in kategoriOptions" :key="k">{{k}}</option>
      </select>

      <select class="form-select w-auto" v-model="filters.special">
        <option value="">Filter Khusus</option>
        <option value="belowSafety">Qty < Safety</option>
        <option value="zero">Stok Habis</option>
      </select>

      <button class="btn btn-outline-secondary" @click="resetStockFilters">Reset</button>
    </div>

    <table class="table table-hover table-striped">
      <thead class="table-primary">
        <tr class="text-center">
          <th>Kode</th><th>Judul</th><th>UPBJJ</th><th>Qty</th><th>Safety</th><th>Status</th><th>Catatan</th><th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(s,i) in displayedStocks" :key="s.kode" class="align-middle text-center">
          <td>{{s.kode}}</td>
          <td>{{s.judul}}</td>
          <td>{{s.upbjj}}</td>
          <td>{{s.qty}}</td>
          <td>{{s.safety}}</td>
          <td>{{statusText(s)}}</td>
          <td>
            <button class="btn btn-sm btn-warning"
                    @mouseover="showNote(i,$event)" @mouseleave="hideNote">
              Catatan
            </button>
          </td>
          <td>
            <div class="btn-group btn-group-sm">
              <button class="btn btn-info" @click="openEditStock(i)">Edit</button>
              <button class="btn btn-danger" @click="confirmDeleteStock(i)">Hapus</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- ==== DO TAB ==== -->
  <section v-show="tab==='do'">

    <div class="d-flex mb-3 gap-2">
      <button class="btn btn-primary" @click="openCreateDO">Tambah DO</button>
      <input type="text" class="form-control w-auto" placeholder="Cari DO/NIM/Nama" v-model="doSearch" />
    </div>

    <table class="table table-bordered table-striped">
      <thead class="table-secondary">
        <tr class="text-center">
          <th>Nomor DO</th><th>NIM</th><th>Nama</th><th>Ekspedisi</th><th>Tgl Kirim</th><th>Aksi</th>
        </tr>
      </thead>
      <tbody>
        <tr v-for="(d,i) in filteredDOs" :key="d.nomor" class="align-middle text-center">
          <td>{{d.nomor}}</td>
          <td>{{d.nim}}</td>
          <td>{{d.nama}}</td>
          <td>{{d.ekspedisi}}</td>
          <td>{{formatDate(d.tanggalKirim)}}</td>
          <td>
            <div class="btn-group btn-group-sm">
              <button class="btn btn-info" @click="openDODetail(i)">Detail</button>
              <button class="btn btn-danger" @click="deleteDO(i)">üóëÔ∏è Hapus</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </section>

  <!-- Tooltip Catatan -->
  <div v-if="tooltip.visible"
       class="tooltip-note"
       :style="{ left: tooltip.x + 'px', top: tooltip.y + 'px' }"
       v-html="displayedStocks[tooltip.index]?.catatanHTML">
  </div>

  <!-- STOCK FORM MODAL -->
  <div v-if="stockForm.visible" class="modal d-block" style="background:#0006;">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <h5 class="mb-3">Form Bahan Ajar</h5>
        <input class="form-control mb-2" placeholder="Kode" v-model="stockForm.data.kode">
        <input class="form-control mb-2" placeholder="Judul" v-model="stockForm.data.judul">
        <input class="form-control mb-2" placeholder="UPBJJ" v-model="stockForm.data.upbjj">
        <input class="form-control mb-2" placeholder="Kategori" v-model="stockForm.data.kategori">
        <input type="number" class="form-control mb-2" placeholder="Qty" v-model="stockForm.data.qty">
        <input type="number" class="form-control mb-2" placeholder="Safety" v-model="stockForm.data.safety">
        <textarea class="form-control mb-2" placeholder="Catatan (HTML)" v-model="stockForm.data.catatanHTML"></textarea>

        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-secondary" @click="closeStockForm">Batal</button>
          <button class="btn btn-success" @click="saveStock">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DO FORM MODAL -->
  <div v-if="doForm.visible" class="modal d-block" style="background:#0006;">
    <div class="modal-dialog">
      <div class="modal-content p-3">
        <h5 class="mb-3">Form Delivery Order</h5>
        <input class="form-control mb-2" disabled v-model="doForm.data.nomor">
        <input class="form-control mb-2" placeholder="NIM" v-model="doForm.data.nim">
        <input class="form-control mb-2" placeholder="Nama" v-model="doForm.data.nama">

        <select class="form-select mb-2" v-model="doForm.data.ekspedisi">
          <option value="">Pilih Ekspedisi</option>
          <option v-for="e in ekspedisiOptions" :key="e">{{e}}</option>
        </select>

        <input type="date" class="form-control mb-3" v-model="doForm.data.tanggalKirimRaw"/>

        <div class="d-flex justify-content-end gap-2">
          <button class="btn btn-secondary" @click="closeDOForm">Batal</button>
          <button class="btn btn-success" @click="saveDO">Simpan</button>
        </div>
      </div>
    </div>
  </div>

  <!-- DO DETAIL -->
  <div v-if="doDetail.visible" class="modal d-block" style="background:#0006;">
    <div class="modal-dialog modal-lg">
      <div class="modal-content p-4">
        <h4>{{doList[doDetail.index]?.nomor}} - {{doList[doDetail.index]?.nama}}</h4>
        <p>NIM: {{doList[doDetail.index]?.nim}}</p>
        <p>Ekspedisi: {{doList[doDetail.index]?.ekspedisi}}</p>

        <hr/>
        <h6>Riwayat Progress:</h6>
        <ul>
          <li v-for="p in doList[doDetail.index]?.progress">
            {{formatDateTime(p.time)}} - {{p.keterangan}}
          </li>
        </ul>

        <textarea class="form-control mb-2" placeholder="Tambah progress baru"
                  v-model="doList[doDetail.index].newProgress"></textarea>

        <button class="btn btn-primary mb-2" @click="addProgressForm()">+ Tambah Progress</button>

        <div class="text-end">
          <button class="btn btn-secondary" @click="doDetail.visible=false">Tutup</button>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- VUE & JS -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script src="apps.js"></script>

</body>
</html>

