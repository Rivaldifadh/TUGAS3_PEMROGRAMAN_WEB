<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manajemen Stok Bahan Ajar & Tracking DO</title>

  <!-- BOOTSTRAP -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="style.css">
  <!-- ICON -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  
  <!-- VUE -->
  <script src="https://unpkg.com/vue@3"></script>
</head>

<body>
<div id="app">

  <!-- ====================== LOGIN SECTION ====================== -->
  <section v-show="!loggedIn" class="d-flex justify-content-center align-items-center" style="height:100vh;">
    <div class="card p-4 shadow-lg" style="width:350px; border-radius:15px;">
      <h3 class="text-center mb-3 fw-bold">Login Sistem</h3>

      <input type="text" class="form-control mb-2" placeholder="Username"
             v-model="loginForm.username"
             @keyup.enter="submitLogin" />

      <input type="password" class="form-control mb-3" placeholder="Password"
             v-model="loginForm.password"
             @keyup.enter="submitLogin"
             @keyup.esc="clearLogin" />

      <button class="btn btn-primary w-100" @click="submitLogin">Masuk</button>

      <p v-if="loginError" class="text-danger text-center mt-2">
        Username atau password salah!
      </p>
    </div>
  </section>

  <!-- ====================== MAIN DASHBOARD ====================== -->
  <section v-show="loggedIn" class="container py-4">

    <!-- NAVBAR -->
    <nav class="navbar navbar-dark bg-dark mb-4 rounded">
      <div class="container-fluid">
        <span class="navbar-brand">üì¶ Dashboard Manajemen Stok & DO</span>
        <button class="btn btn-danger" @click="logout">Logout</button>
      </div>
    </nav>

    <h2 class="mb-3 text-center fw-bold">üìö Manajemen Stok Bahan Ajar & Tracking Delivery Order</h2>

    <!-- TAB -->
    <div class="d-flex gap-2 justify-content-center mb-4">
      <button class="btn" :class="{ 'tab-btn-active': tab==='stok' }" @click="tab='stok'">Manajemen Stok</button>
      <button class="btn" :class="{ 'tab-btn-active': tab==='do' }" @click="tab='do'">Tracking DO</button>
    </div>

    <!-- ==== STOCK TAB ==== -->
    <section v-show="tab==='stok'">
      <div class="d-flex mb-3 gap-2">
        <button class="btn btn-primary" @click="openCreateStock">Tambah Bahan Ajar</button>

        <select class="form-select w-auto" v-model="filters.upbjj">
          <option value="">Semua UPBJJ</option>
          <option v-for="u in upbjjList" :key="u">{{u}}</option>
        </select>

        <select class="form-select w-auto" v-model="filters.kategori">
          <option value="">Semua Kategori</option>
          <option v-for="k in kategoriOptions" :key="k">{{k}}</option>
        </select>

        <select class="form-select w-auto" v-model="filters.special">
          <option value="">Filter Khusus</option>
          <option value="belowSafety">Qty &lt; Safety</option>
          <option value="zero">Stok Habis</option>
        </select>

        <button class="btn btn-outline-secondary" @click="resetStockFilters">Reset</button>
      </div>

      <table class="table table-hover table-striped">
        <thead class="table-primary">
          <tr class="text-center">
            <th>Kode</th><th>Judul</th><th>UPBJJ</th><th>Qty</th><th>Safety</th><th>Status</th><th>Catatan</th><th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(s,i) in displayedStocks" :key="s.kode" class="align-middle text-center">
            <td>{{s.kode}}</td>
            <td>{{s.judul}}</td>
            <td>{{s.upbjj}}</td>
            <td>{{s.qty}}</td>
            <td>{{s.safety}}</td>
            <td>{{statusText(s)}}</td>
            <td>
              <button class="btn btn-sm btn-warning"
                      @mouseover="showNote(i,$event)" @mouseleave="hideNote">Catatan</button>
            </td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-info" @click="openEditStock(i)">Edit</button>
                <button class="btn btn-danger" @click="confirmDeleteStock(i)">Hapus</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- ==== DO TAB ==== -->
    <section v-show="tab==='do'">
      <div class="d-flex mb-3 gap-2">
        <button class="btn btn-primary" @click="openCreateDO">Tambah DO</button>
        <input type="text" class="form-control w-auto" placeholder="Cari DO/NIM/Nama" v-model="doSearch" />
      </div>

      <table class="table table-bordered table-striped">
        <thead class="table-secondary">
          <tr class="text-center">
            <th>Nomor DO</th><th>NIM</th><th>Nama</th><th>Ekspedisi</th><th>Tgl Kirim</th><th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(d,i) in filteredDOs" :key="d.nomor" class="align-middle text-center">
            <td>{{d.nomor}}</td>
            <td>{{d.nim}}</td>
            <td>{{d.nama}}</td>
            <td>{{d.ekspedisi}}</td>
            <td>{{formatDate(d.tanggalKirim)}}</td>
            <td>
              <div class="btn-group btn-group-sm">
                <button class="btn btn-info" @click="openDODetail(i)">Detail</button>
                <button class="btn btn-danger" @click="deleteDO(i)">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </section>

  </section>
</div>

<!-- APPS JS -->
<script src="apps.js"></script>

</body>
</html>
